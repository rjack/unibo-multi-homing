	  Progetto di Laboratorio di Programmazione di Rete 2006/07
     "Fornire interattività a comunicazione TCP sfruttando multi-homing"

			   PROTOCOLLO APPLICAZIONE

		    Giacomo Ritucci <ritucci@cs.unibo.it>


  Info necessarie nei segmenti

- conformazione: 		flags
- ordine ricostruzione: 	seqnum

Flags:
- critico: è stato spedito su tutti i canali
- dati: ha il payload

NB: se è critico e non ha il payload è un NACK.


  Ricostruzione segmenti

Solita joining queue di segmenti ordinati:

   jq: | 5 | -> | 7 | -> | 12 |

Un segmento è nella jq <==> non ha il seqnum successivo a quello dell'ultimo
segmento inviato all'host: mancano uno o piu' segmenti!

Quindi... insert in jq -> manda NACK all'altro proxy per chiedere segmento
mancante.

Problema: se mando NACK subito appena inserisco segmento in jq sovraccarico
canale e peggioro le cose, obbligando l'altro proxy a rispedire il segmento (e
magari bastava aspettare un attimo)

Ma se aspetto troppo sforo il tetto dei 500ms!
Attesa invio NACK: 130-150ms

NACK delay da tarare bene! Ogni loop decremento un timer associato ai segmenti
nella jq, quando scade mando il NACK, se arriva il segmento in tempo rimuovo
il timer.


  Routing segmenti

Condizione migliore (nessun ritardo) -> meglio un segmento per ogni canale,
politica round robin.

Condizione peggiore (congestioni frequenti) -> ridondanza per diminuire
probabilità che segmento incontri un ritardo. Non rischio di intasare tutto?!
Sicuramente sì: bisogna che solo i segmenti in ritardo vengano mandati in più
copie, in modo da minimizzare gli sprechi.

Traffico normale: ogni segmento inviato sul suo canale.
Traffico critico: quando ricevo un NACK, il segmento richiesto lo rispedisco
su tutti i canali, per essere sicuro che arrivi in tempo.

Un canale con il ritardatore deve avere associato un timeout che viene
ripristinato ogni volta che c'è attività. Se scade il canale viene invalidato.
AliveTimeout: tra i 600ms e 1s.

Che si fa con i segmenti in coda per quel canale?
- se sono critici si buttano, i duplicati sono già stati spediti sugli altri
  canali e non ha senso ritrasmetterli,
- se sono normali vanno messi in testa alle code degli altri canali,
  distribuendoli uniformemente.
